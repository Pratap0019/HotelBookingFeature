<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Booking - Pratap Hotels</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            background-color: #dcdcdc;
            font-family: 'Poppins', sans-serif;
            padding-top: 130px;
        }
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .header {
            background-image: url('https://images.unsplash.com/photo-1505761671935-60b3a7427bad?auto=format&fit=crop&w=1500&q=80');
            background-size: cover;
            background-position: center;
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            z-index: 1000;
            height: 100px;
            display: flex;
            align-items: center;
            padding: 15px 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .header-content {
            background: rgba(255, 255, 255, 0.75);
            border-radius: 12px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
    </style>
</head>
<body>
<!-- Header -->
<div class="header">
    <div class="container-fluid">
        <div class="row g-3 align-items-center">
            <div class="col-sm-3">
                <a href="/" style="text-decoration: none; color: inherit;">
                <div class="header-content">
                    <div>
                        <h3 class="mb-0">PRATAP HOTELS</h3>
                        <p class="mb-0">Where Comfort Meets Royalty</p>
                    </div>
                </div>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <h2 class="text-center mb-4">Book Your Stay</h2>

    <!-- Booking Form -->
    <div class="card p-4">
        <form action="/calculatePrice" method="post">

            <!-- Room Number -->
            <div class="mb-3">
                <label class="form-label">Room Number</label>
                <select class="form-select" name="roomNumber" required>
                    <option value="" disabled selected>Select Room</option>
                    <option th:each="room : ${rooms}"
                            th:if="${!room.booked}"
                            th:value="${room.roomNumber}"
                            th:text="'Room ' + ${room.roomNumber} + ' (' + ${room.roomType} + ')'">
                    </option>
                </select>
            </div>

            <!-- Check-in & Check-out -->
            <div class="row mb-3">
                <div class="col">
                    <label class="form-label">Check-in Date</label>
                    <input type="date" id="checkIn" class="form-control" required>
                </div>
                <div class="col">
                    <label class="form-label">Check-out Date</label>
                    <input type="date" id="checkOut" class="form-control" required>
                </div>
            </div>

            <!-- Days Stayed -->
            <div class="mb-3">
                <label class="form-label">Days Stayed</label>
                <input type="number" id="daysStayed" name="daysStayed" class="form-control" readonly required>
            </div>

            <!-- Extras -->
            <div class="mb-3">
                <label class="form-label">Extras</label>
                <div class="form-check" th:each="extra : ${extrasRate}">
                    <input class="form-check-input" type="checkbox" name="extras"
                           th:value="${extra.key}">
                    <label class="form-check-label" th:text="${extra.key} + ' (' + ${extra.value} + ' ₹/day)'"></label>
                </div>
            </div>

            <!-- Pet Weight -->
            <div class="mb-3">
                <label class="form-label">Pet Weight (kg)</label>
                <input type="number" step="0.1" class="form-control" name="petWeight" placeholder="Optional">
            </div>

            <!-- Calculate Price Button -->
            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">Calculate Price</button>
            </div>
        </form>
    </div>

    <!-- Price Breakdown -->
    <div th:if="${bill}" class="card mt-4 p-4">
        <h4>Price Breakdown</h4>
        <table class="table table-bordered">
            <thead class="table-dark">
            <tr>
                <th>Item</th>
                <th>Charge (₹)</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="entry : ${bill.breakdown}">
                <td th:text="${entry.key}"></td>
                <td th:text="${entry.value}"></td>
            </tr>
            <tr class="table-success">
                <td><strong>Total</strong></td>
                <td><strong th:text="${bill.getTotalAmount}"></strong></td>
            </tr>
            </tbody>
        </table>

        <!-- Confirm Booking Form -->
        <form action="/confirmBooking" method="post" class="text-center mt-3">
            <!-- Use model attributes instead of bill -->
            <input type="hidden" name="roomNumber" th:value="${roomNumber}">
            <input type="hidden" name="daysStayed" th:value="${daysStayed}">
            <input type="hidden" name="totalAmount" th:value="${bill.totalAmount}">
            <button type="submit" class="btn btn-success btn-lg">Confirm Booking</button>
        </form>
    </div>

    <!-- Success Message -->
    <div th:if="${successMessage}" class="alert alert-success mt-4 text-center" role="alert">
        <span th:text="${successMessage}"></span>
    </div>


    <!-- JS to calculate days between dates -->
<script>
    const checkIn = document.getElementById("checkIn");
    const checkOut = document.getElementById("checkOut");
    const daysStayed = document.getElementById("daysStayed");

    function calculateDays() {
        if (checkIn.value && checkOut.value) {
            const inDate = new Date(checkIn.value);
            const outDate = new Date(checkOut.value);
            const diffTime = outDate - inDate;
            const diffDays = diffTime / (1000 * 60 * 60 * 24);
            daysStayed.value = diffDays > 0 ? diffDays : 0;
        }
    }

    checkIn.addEventListener("change", calculateDays);
    checkOut.addEventListener("change", calculateDays);
</script>
</body>
</html>
